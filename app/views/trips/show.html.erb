<% content_for :meta_description do %><%= @trip.name %><% end %>
<% content_for :meta_image do %><%= @trip.images.first.try(:link) %><% end %>
<h1><%= @trip.name %></h1>
<h4>
  <span><%= @trip.date_range %></span>
  <span> | <%= link_to "Imgur Album", @trip.album.link, target: :_blank %></span>
  <% if @trip.users.include?(current_user) %>
    <% if current_user.admin? %>
      <span> | <%= link_to "Edit Missionaries", trip_users_path(@trip.id) %></span>
    <% end %>
    <span> | <%= link_to "Edit Images", mission_images_path(current_user.username, @trip.id) %></span>
  <% end %>
</h4>
<div class="row">
  <div class="col-md-4 col-md-push-8">
    <h4>User's Images</h4>
    <div class="row">
      <% @trip.users.each do |user| %>
        <div class="col-md-12">
          <%= link_to mission_path(username: user.username, trip_id: @trip.id) do %>
            <%= "#{user.name} (#{Image.where(user_id: user.id, trip_id: @trip.id).count})" %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
  <div class="col-md-8 col-md-pull-4 border-right">
    <% @images = @trip.images.page(params[:page]).per(24) %>
    <div class="text-center"><%= paginate @images %></div>
    <div class="row">
      <% @images.each_with_index do |image, index| %>
        <% if (index % 3).zero? && !index.zero? %>
          </div><div class="row margin-top-30">
        <% end %>
        <div class="col-md-4">
          <%= link_to image_path image.id do %>
            <%= image_tag image.link, class: "img-responsive" %>
          <% end %>
          <%= link_to "#", class: "favorite-image", data: { image_id: image.id } do %>
            <%= fa_icon "2x heart#{"-o" unless current_user.favorites.exists?(image_id: image.id)}"%>
          <% end if current_user %>
        </div>
      <% end %>
    </div>
    <div class="text-center"><%= paginate @images %></div>
  </div>
</div>
